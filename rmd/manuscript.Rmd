---
title: "Ecosystem size and complexity as extrinsic drivers of food chain length in branching ecosystems"
output:
  pdf_document:
    latex_engine: xelatex
knit: (function(inputFile, encoding) {
        rmarkdown::render(inputFile, encoding = encoding, output_dir = "document_output")
      })
bibliography: references.bib
csl: https://www.zotero.org/styles/ecosphere
mainfont: Times New Roman
header-includes:
  \usepackage{lineno, textgreek}
  \linenumbers
---

```{r setup, include=FALSE}

library(tidyverse)

knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE)

# Sensitivity data
df_sim <- readRDS(here::here("output/sim_main.rds")) %>% 
  filter(r_b %in% c(8, 16))

n_rep <- max(df_sim$n_rep)

n_scenario <- df_sim %>% 
  filter(sd_disturb_source > sd_disturb_lon) %>% 
  summarize(n = n_distinct(param_set)) %>% 
  pull(n)

n_sim <- df_sim %>% 
  mutate(n_sim = n_timestep + n_burnin + n_warmup) %>% 
  pull() %>% 
  unique()
```

Author: Justin P.F. Pomeranz^1,2^, Jacques C. Finlay^3^, Akira Terui^1^

1 Department of Biology, University of North Carolina at Greensboro; 2 Department of Environmental Sciences, Colorado Mesa University; 3 Department of Ecology, Evolution and Behavior, University of Minnesota

\*Corresponding Author: JPF Pomeranz, [jfpomeranz\@gmail.com](mailto:jfpomeranz@gmail.com){.email}; A Terui, [hanabi0111\@gmail.com](mailto:hanabi0111@gmail.com){.email}

# Abstract

Understanding the drivers of food chain length in natural communities has intrigued ecologists since Elton publicized 'food cycles' in the early 20th century. Proposed drivers of food chain length have included productivity, disturbance regime, ecosystem size, and trophic omnivory. However, current theories have largely assumed simple, two-dimensional habitat architectures and may not be adequate to predict food chain length in ecosystems with a complex, branching structure. Here, we develop a spatially explicit theoretical model which provides an integrated framework for understanding variation in food chain length in branching networks. We show independent, positive influences of ecosystem size and complexity on food chain length. However, these effects were contingent upon other drivers. In particular, the effects of ecosystem size and complexity appeared more clearly in high disturbance regimes. Our results suggest that ecosystem complexity is an important yet overlooked driver of food chain length in branching ecosystems.

**Keywords:** Food chain length, omnivory, branching networks, fractals, intraguild predation, complex network architecture

## Data availability

No data were used or produced in this research. R functions for simulations are provided as the R package mcbrnet version 1.3.0 (available at <https://github.com/aterui/mcbrnet>). Codes for simulations, statistical analysis, figures, and tables are available at <https://github.com/aterui/public-proj_fcl-river-theory>.

\clearpage

# Introduction

The origin of variation in food chain length (FCL), the number of feeding links from the basal species to top predators, has intrigued ecologists for decades due to its importance in regulating top-down effects [@paceTrophicCascadesRevealed1999], energy flow [@wangBiodiversityEcosystemFunctioning2018], and contaminant concentrations in top predators [@kiddEffectsTrophicPosition1998]. Hypotheses regarding controls of FCL can be organized into three broad categories. First, the resource availability hypothesis states that basal productivity controls FCL because imperfect energy conversion through predator-prey interactions restricts energy available to higher trophic levels [@oksanenExploitationEcosystemsGradients1981]. Second, the disturbance hypothesis (or the dynamical stability hypothesis) predicts longer food chains are vulnerable to environmental perturbations (i.e., the dynamical constraint). Thus, habitats with frequent and/or severe disturbance should support fewer trophic levels [@pimmNumberTrophicLevels1977]. Lastly, the ecosystem size hypothesis posits that larger ecosystems should harbor longer food chains [@takimotoEffectsProductivityDisturbance2012; @teruiSpatialDisturbanceSynchrony2019; @postEcosystemSizeDetermines2000].

Among the three hypotheses, the ecosystem size hypothesis has been consistently supported in empirical explorations, likely because it encompasses multiple mechanisms [@takimotoEnvironmentalDeterminantsFoodchain2013]. For example, large ecosystems have increased species richness (species-area relationship [@lomolinoEcologyMostGeneral2000]), are buffered against disturbances [@saboRoleDischargeVariation2010], and have greater numbers of immigrant sources in the ecosystem with stable metapopulations [@takimotoEnvironmentalDeterminantsFoodchain2013]. Meanwhile, the theoretical basis for the other two hypotheses rests on implicit assumptions of linear food chains, which are often violated in natural systems. As such, the effects of disturbance and resource availability on FCL have been found to be highly variable among ecosystem types and geographic regions [@takimotoEffectsProductivityDisturbance2012; @diehlIntraguildPreySuffer2001; @takimotoEnvironmentalDeterminantsFoodchain2013; @postLongShortFoodchain2002]. 

More recently, food web ecologists have begun to recognize that FCL rarely responds to a single driver, but instead is determined by interactions of multiple factors. For example, @wardMechanisticTheoryAquatic2017 showed that FCL was more responsive to increasing productivity in large ecosystems than small ones, whereas FCL was more sensitive to size in low-productivity systems. Such context-dependent responses to extrinsic factors seem to be tightly coupled with the arrangement of trophic links within a food web. For example, omnivory (feeding at multiple trophic levels) is a strong intrinsic driver of FCL [@takimotoEffectsProductivityDisturbance2012; @postProximateStructuralMechanisms2007; @woottonOmnivoryStabilityFreshwater2017]. When omnivory is absent in three-species communities, the trophic structure assumes a simple linear food chain with a maximum length of three (**Figure 1D**). However, FCL decreases proportionally with increasing omnivory as the top predator eats lower in the food web [@wardMechanisticTheoryAquatic2017; @woottonOmnivoryStabilityFreshwater2017]. Theoretical work predicts that food webs are destabilized when omnivory is too strong, leading to the loss of species and shorter food chains [@woottonOmnivoryStabilityFreshwater2017]. Conversely, weak omnivory stabilizes the food web and increases the persistence of species within a community, particularly at intermediate levels of productivity and high disturbance levels [@woottonOmnivoryStabilityFreshwater2017; @woottonManyWeakInteractions2016]. Due to the context-dependency of FCL to multiple drivers and the potential for interactive effects, a unified framework of multiple FCL drivers is needed to better understand when and where FCL will respond to these extrinsic and intrinsic factors. 

While recent research efforts of food web ecologists have substantially advanced our understanding of food chain drivers, most of the previous work has been conducted in simple, two-dimensional systems, such as lakes [@postEcosystemSizeDetermines2000; @doiResourceAvailabilityEcosystem2009] and oceanic islands [@takimotoEcosystemSizeNot2008]. However, many natural habitats have a high degree of spatial complexity that cannot be represented simply by ecosystem size. Branching ecosystems, for example, are ubiquitous yet overlooked landscape structures (e.g., rivers, trees, caves, mountain ranges) [@grantLivingBranchesPopulation2007; @altermattDiversityRiverineMetacommunities2013]. While we know that food web interactions are spatially influenced [@calcagnoConstraintsFoodChain2011; @pillaiMetacommunityTheoryExplains2011; @takimotoEffectsProductivityDisturbance2012; @teruiSpatialDisturbanceSynchrony2019], the theory to account for it has lagged, particularly in branching habitat architectures. Here, we theoretically explore drivers of FCL in rivers, an excellent example of branching ecosystems.

Ample evidence suggests that branching structure controls environmental heterogeneity and dispersal pathways for organisms within river ecosystems [@altermattDiversityRiverineMetacommunities2013; @tonkinRoleDispersalRiver2018]. Water and materials propagate downstream as small streams hierarchically join to form larger streams and rivers. Consequently, environmental signals (e.g., flood disturbance) are highly variable among tributaries while showing a strong within-tributary correlation [@nakamuraDisturbanceRegimesStream2000; @isaakSlowClimateVelocities2016; @mcguireNetworkAnalysisReveals2014; @abbottUnexpectedSpatialStability2018]. Confluences are merging points where tributary dynamics aggregate to form distinct environmental conditions in downstream habitat patches. Hence, habitat heterogeneity increases with branching complexity (**Figure 1A**), which we define here as the probability of branching per unit river distance. Highly-branched river networks provide diverse habitats that buffer the impact of large-scale environmental fluctuations, broadening opportunities for species to recolonize habitat patches post-disturbance [@teruiMetapopulationStabilityBranching2018]. Thus, ecosystem complexity in river networks may be a widespread yet overlooked extrinsic environmental driver of FCL. 

We simulate trophic community dynamics within branching habitats to investigate the effects of extrinsic controls of FCL, such as ecosystem size (number of patches), complexity (branching probability), and disturbance regime. In addition, our simulation model incorporates intrinsic drivers of FCL, including the degree of omnivory, productivity level, and species' dispersal ability, allowing us to assess the context dependency on drivers of FCL across extrinsic factors. We find that ecosystem size and complexity are both positively related to FCL, but the form of this relationship is dependent on other extrinsic and intrinsic factors. Our model is an important step in unifying drivers of FCL across extrinsic and intrinsic drivers and parsing their context-dependency in spatially complex ecosystems.

# Methods

## **Network generation**

We generated branching networks as connected habitat patches (**Figure 1A;** see **Table 1** for parameter notations). The geometric arrangement of networks was controlled by two parameters: ecosystem size, the number of patches ($N_{p}$); and ecosystem complexity, branching probability ($P_{b}$). Habitat patches were assigned to be a confluence (or upstream terminal patch) with probability $P_{b}$, or an in-branch patch with probability $1-P_{b}$. Branches (tributaries) are a series of connected patches between confluences (or upstream terminal patches). The number of patches within branch $q$, $n_{p,q}$, is a random variable drawn from a geometric distribution $n_{p,q} \sim \text{Ge}(P_{b})$ but conditional on $N_{p} = \sum_{q}^{N_{b}} n_{p,q}$ ($N_{b}$ is the number of branches in a network). Full details of the network generation process is described in @teruiEmergentDualScaling2021.

In our simulation, disturbance occurs simultaneously across habitat patches with probability $p_m$ but the patches vary in their vulnerability. We simulated the spatial distribution of disturbance intensity (i.e., proportional mortality in the event of stochastic regional disturbance) as follows. A disturbance value, $m_{h}$, was assigned randomly to upstream terminal patch $h$ as $\text{logit}~m_{h} \sim \text{Normal}(\text{logit}~\mu_m, \sigma_{h}^2)$, where $\mu_m$ is the average of disturbance intensity at headwaters in an ordinary scale. The disturbance values propagate downstream through a spatial autoregressive process as:

$$
\begin{aligned}
\text{logit}~m_{down} &= \text{logit}~m_{up}+ \varepsilon &&\text{(1)}
\end{aligned}
$$

where $m_{down}$ and $m_{up}$ are the disturbance values at down- and upstream patches, and the local environmental noise at the downstream patch $\varepsilon$ was drawn from $\text{Normal}(0, \sigma_{l}^2)$. This autoregressive process resembles a natural disturbance regime, where flood or drought disturbance cascades downstream with some local variation along the channel [@nakamuraDisturbanceRegimesStream2000]. At confluence patches, the disturbance value takes a weighted mean based on the relative size of the two contributing branches, $Q$ (the number of upstream contributing patches + 1):

$$
\begin{aligned}
\text{logit}~m_{down} &= \omega~(\text{logit}~m_{1,up} +\varepsilon_1)+(1-\omega)~(\text{logit}~m_{2,up} +\varepsilon_2) &&\text{(2)}
\end{aligned}
$$

$m_{1,up}$ and $m_{2,up}$ are the disturbance values of upstream contributing tributaries, $\varepsilon_1$ and $\varepsilon_2$ are independent local noises, and $\omega$ the relative size of one tributary over another defined as $\omega = \frac{Q_{1}}{Q_{1} + Q_{2}}$. Thus, the larger tributary has a greater influence on the downstream environment, as observed in natural river networks [@bendaNetworkDynamicsHypothesis2004]. Disturbance value distributions had medians close to $\mu_m$ with long tails (**Figure 1B**). The low-magnitude patches can be viewed as refugia, which supply individuals to impacted sites in subsequent time steps.

We also mimicked the downstream increase of local carrying capacity reflecting downstream increases in algal resource availability [@teruiThreeEcologicalFactors2016; @carraraComplexInteractionDendritic2014; @rahelFishAssemblagesHabitat1991]. Carrying capacity in patch $x$, $K_x$, was assumed to increase as a power function of ecosystem area (i.e., watershed area) [@finlayStreamSizeHuman2011; @koenigEmergentProductivityRegimes2019]: 

$$
\begin{aligned}
K_{x} &= K_{base}Q_{x}^z &&\text{(3)}
\end{aligned}
$$

where $K_{base}$ is the carrying capacity at the upstream terminal patch, and $z$ the scaling exponent. In this formulation, the most upstream patch, at which $Q_x = 1$ (the number of upstream patches + 1), has the carrying capacity of $K_{base}$. We used $K_{base} = 500$ and $z = 0.54$ based on an empirical relationship of gross primary production and watershed area [@finlayStreamSizeHuman2011]. 

## **Tri-trophic model**

We employed a discrete-time model to describe tri-trophic dynamics in each habitat patch (see **Table 1** for parameter notations). A discrete model is suitable for organisms with predictable reproduction cycles, a common life history for many lotic species, including macroinvertebrates and fish. Our simulation model consists of three species; a basal species $B$ with positive logistic growth up to a carrying capacity, $K$; a primary consumer species or intraguild prey, $C$, which grows based on the consumption of $B$; and an intraguild predator $P$, which can consume both $B$ and $C$ (**Figure 1C**). The realized species abundance $A_{ix,t+1}$ for species $i$ (either $B,C,~or~P$) at patch $x$ and time $t+1$ is expressed as a composite of within-patch trophic interactions, immigration, and emigration:

$$
\begin{aligned}
A_{ix,t+1} &\sim \text{Poisson}(\bar{A}_{ix,t} + I_{ix,t} - E_{ix,t}) &&\text{(4)}
\end{aligned}
$$

where $\bar{A}_{ix,t}$ is the expected species abundance after within-patch trophic interactions, $I_{ix,t}$ the expected number of immigrants into patch $x$, and $E_{ix,t}$ the expected number of emigrants from patch $x$. The realized discrete number of individuals is drawn from a Poisson distribution to account for stochasticity in demographic and dispersal processes.

***Internal dynamics.*** Each time step starts with internal dynamics. The general formula is the extension of the Nicholson-Bailey model, which is given as follows:

$$
\begin{aligned}
B^+_{x,t} &= B_{x,t}g(B_{x,t})f_1(B'_{x,t}, C_{x,t})f_2(B'_{x,t}, P_{x,t})\\
C^+_{x,t} &= e_{BC}B'_{x,t}[1 - f_1(B'_{x,t}, C_{x,t})]f_3(C'_{x,t}, P_{x,t})\\
P^+_{x,t} &= e_{BP}B'_{x,t}f_1(B'_{x,t}, C_{x,t})[1 - f_2(B''_{x,t}, P_{x,t})] + e_{CP}C_{x,t}[1 - f_3(C'_{x,t}, P_{x,t})]
~~\text{(5)}
\end{aligned}
$$

where $e_{ij}$ is the energetic conversion efficiency from $i$ to $j$. The function $g(\cdot)$ defines the density-dependent recruitment for the basal species, and the function $f_k(\cdot)$ dictates the proportion of survived prey individuals after predation. In the above equations, we re-defined variables as follows to simplify the expression:

$$
\begin{aligned}
B'_{x,t} &= B_{x,t}g(B_{x,t}) &&\text{after B's recruitment}\\
B''_{x,t} &= B'_{x,t}f_1(B'_{x,t}, C_{x,t}) &&\text{after C's predation on B}\\
C'_{x,t} &= e_{BC}B'_{x,t}[1 - f_1(B'_{x,t}, C_{x,t})] &&\text{after C's recruitment}
\end{aligned}
$$

The model assumes that ecological events occur in the following order: (1) $B$'s recruitment, (2) $C$'s predation on $B$ followed by its recruitment, and (3) $P$'s predation on $B$ and $C$ followed by its recruitment. We assumed that the intraguild prey $C$ consumes the basal species $B$ first because the species is specialized to prey on $B$.

We used the Beverton-Holt function to describe the density-dependent growth of the basal species:

$$
\begin{aligned}
g(B_{x,t}) = \frac{r_{b}} {1 + \frac{r_b - 1}{K_{x}}B_{x,t}} &&\text{(11)}
\end{aligned}
$$

where $r_{B}$ is the intrinsic growth rate and $K_x$ is the carrying capacity at patch $x$. We assumed the Type-II functional response in the survival function $f_k(\cdot)$ as follows:

$$
\begin{aligned}
f_1(B'_{x,t}, C_{x,t}) &= \exp \left(-\frac{a_{BC} C_{x,t}} {1 + a_{BC} h_{BC} B'_{x,t}} \right) &&\text{C on B}\\
f_2(B''_{x,t}, P_{x,t}) &= \exp \left(-\frac{(1 + \phi) a_{BP} P_{x,t}} {1 + a_{BP} h_{BP} B''_{x,t}} \right) &&\text{P on B}\\
f_3(C'_{x,t}, P_{x,t}) &= \exp \left(-\frac{(1 - \phi) a_{CP} P_{x,t}} {1 + a_{CP} h_{CP} C'_{x,t}} \right) &&\text{P on C}
\end{aligned}
$$

The parameter $a_{ij}$ defines $j$'s attack rate to $i$, $h_{ij}$ the handling time, and $\phi$ the switching function for the intraguild predator. We assumed that switching is dependent on the relative abundance of $B''_{x,t}$ and $C'_{x,t}$:

$$
\phi = \frac{s(B''_{x,t} - C'_{x,t})}{B''_{x,t} + C'_{x,t}}
$$

where the parameter $s$ determines the strength of switching ($0 \le s \le 1$). In this expression, the intraguild predator increases its attack rate to the basal species if $\phi > 0$, properly representing the switching behavior of the intraguild prey.

***Disturbance.*** After recruitment, all species experience proportional loss if stochastic regional disturbance occurs:

$$
\begin{aligned}
\bar{A}_{ix,t}(t) &= A^+_{ix,t} (1 - \nu_t m'_{x,t}) &&\text{(15)}
\end{aligned}
$$

where $m'_{x,t}$ is the disturbance intensity at patch $x$ and time $t$, which was drawn from a Beta distribution with mean $m_x$ and precision $1000$. The mean disturbance intensity $m_x$ is determined by the network generation process. The random variable $\nu_t$ represents the incidence of regional disturbance ($\nu_t = 1$ if disturbance occurs, otherwise zero), which is drawn from a Bernoulli distribution as $\nu_t \sim \text{Bernouilli}(p_m)$.

***Dispersal.*** We simulated distance-dependent dispersal along with a network. The number of emigrants from patch $x$ at time $t$, $E_{ix,t}$, is estimated as the product of dispersal probability $p_{d}$ and species abundance after internal dynamics $\bar{A}_{ix,t}$. The dispersal probability was assumed to be constant for all three species. We calculated the relative immigration potential $\xi_{ix,t}$ considering network structure and species dispersal capability as follows: 

$$
\begin{aligned}
\xi_{ix,t} &= \frac{\sum_{y, y \ne x}E_{iy,t}\exp(-\theta d_{xy})}{\sum_{x} \sum_{y, y \ne x}E_{iy,t}\exp(-\theta d_{xy})}
&&\text{(16)}
\end{aligned}
$$

where $d_{xy}$ is the network distance between patch $x$ and $y$ (shortest path), and $\theta$ indicates the inverse of mean dispersal distance (i.e., larger numbers mean shorter dispersal distance). The immigration potential at patch $x$, $\sum_{y, y \ne x}E_{iy,t}\exp(-\theta d_{xy})$, is scaled by the sum of immigration potential across patches so that $\sum_{x} \xi_{i,x}=1$. The expected number of immigrants into patch $x$ is calculated as $I_{ix,t}=\xi_{ix,t} \sum_{x}E_{ix,t}$.

***Food chain length.*** At each patch and time step, we determined local FCL as the highest trophic position ($\tau_{x,t}$) of the existing species. When the predator exists, the trophic position is determined as follows:

$$
\begin{aligned}
\tau_{x,t} &= \delta_{x,t} + 2(1 - \delta_{x,t}) + 1
&&\text{(17)}
\end{aligned}
$$

where $\delta_{x,t}$ is the derived parameter that represents the degree of omnivory and is defined as:

$$
\delta_{x,t} = \frac{e_{BP}B'_{x,t}f_1(B'_{x,t}, C_{x,t})[1 - f_2(B''_{x,t}, P_{x,t})]}{P^+_{x,t}}
$$

Thus, our definition accounts for the influence of omnivory. We defined the global FCL $\bar{\tau}$ across patches $N_p$ and time $T$ as $\bar{\tau} = \frac{\sum_x \sum_t \tau_{x,t}}{N_p T}$ (i.e., average over space and time).

## Simulation

Prior to the main simulation, we performed a one-patch simulation to explore the predation parameter space ($a_{ij}$ and $h_{ij}$) that allows stable coexistence of the three species without disturbance. In this simulation, we assumed $h_{ij} = h$ to reduce the dimension of parameter space. This analysis revealed that the stable coexistence of the three species is possible with a certain combinations of predation parameters. Within this parameter space, we used three parameter combinations to represent distinctive food webs with varied levels of omnivory: "chain (no omnivory)" [$(a_{BC}, a_{BP}, a_{CP}, h) = (0.5, 0, 0.0025, 0.5)$], "weak omnivory" ($0.5, 0.02, 0.025, 0.5$), and "strong omnivory" ($0.5, 0.04, 0.0025, 0.75$). We used $s = 1$ except for the chain scenario with $s = 0$. Without the loss of generality, we assumed $e_{ij} = e = 1$.

Under each scenario of omnivory, we crossed disturbance (frequency and intensity), productivity, and dispersal. Disturbance frequency and intensity were controlled via $p_m$ ( `r unique(df_sim$p_disturb) %>% sort()`) and $\mu_m$ (`r unique(df_sim$mean_disturb_source) %>% sort()`), respectively. Spatial variation in disturbance intensity at headwaters ($\sigma_{h}=$ `r max(df_sim$sd_disturb_source)`), and local disturbance variation ($\sigma_{l}=$ `r min(df_sim$sd_disturb_lon)`). This setup ($\sigma_h > \sigma_l$) produces high spatial variation among tributaries while allowing strong within-tributary downstream correlation, a typical pattern in real river networks [@nakamuraDisturbanceRegimesStream2000; @bendaNetworkDynamicsHypothesis2004]. We used the basal species' growth rate $r_b$ (`r unique(df_sim$r_b)`) as a proxy for resource availability as it resembles the gross primary production. For dispersal, we examined short- and long-distance dispersal scenarios (short-distance dispersal $\theta=$ `r max(df_sim$theta)`; long-distance dispersal $\theta=$ `r min(df_sim$theta)`) with constant dispersal probability ($p_{d}=$ `r unique(df_sim$p_dispersal)`).

We ran `r max(df_sim$n_rep)` simulation replicates with `r n_sim` timesteps of trophic dynamics (including `r n_sim - unique(df_sim$n_timestep)` steps of warmup and burn-in). During the warmup period (`r unique(df_sim$n_warmup)` time steps), we introduced propagules into habitat patches every 10 time steps to allow species to establish populations. Propagules are random draws from $\text{Poisson}(\lambda)$ ($\lambda=100, 10,~\text{and}~1$ for $B$, $C$, and $P$, respectively). Subsequently, we ran a burn-in period with no propagules for `r unique(df_sim$n_burnin)` time steps to remove the effects of initial conditions. We obtained the global FCL $\bar{\tau}$ for the last `r unique(df_sim$n_timestep)` time steps. Note that simulation replicates are differ in ecosystem size ($N_{p}\sim \text{Unif}(10,150)$) and ecosystem complexity ($P_{b} \sim \text{Unif}(0.01, 0.99)$) so we can estimate their effects on FCL. All analysis was performed in R 4.1.0 [@rcoreteamLanguageEnvironmentStatistical2021]

# Results

## Overall pattern

There were three consistent patterns in the relationship between FCL and ecosystem properties. First, both ecosystem size and complexity had a stronger positive effect in high disturbance regime. Second, the effects of ecosystem complexity was stronger than ecosystem size in general. Third, omnivory had a negative influence on the FCL regardless of simulation scenarios. Below, we report our results for low and high disturbance regimes separately.

## **Low disturbance regime**

In ecosystems with a low disturbance regime, omnivory largely determined FCL (colored lines in **Figure 2**), with no-omnivory food chains ($P$ only consumes $C$) having the longest FCL, and strong omnivory ($P$ consumes very little $C$) having the shortest FCL. The primary mechanism for the decreased FCL was different in low and high productivity scenarios. With low productivity, strong omnivory caused shorter FCL because it intensified competition between consumer and predator species. We can see this effect in the decreased occupancies of consumer and predator species in a low productivity scenario (most left column in **Figure S1 -- S4**). However, when productivity was high, the occupancies of both species were \~1.0, indicating that the structural constraint of strong omnivory made FCL shorter (second column from left in **Figure S1 -- S4**). Productivity played a secondary role in increasing FCL, particularly when omnivory was strong (compare left and right panels in **Figure 2A and 2B**). Dispersal had no apparent effects on FCL (compare top and bottom panels in **Figure 2A and 2B**).

Although the effects of ecosystem properties on FCL were minimal, there were noticeable effects on the occupancies of constituent species in some scenarios. For example, the occupancies of $C$ and $P$ increased with ecosystem size when omnivory was strong (see bottom two rows in left most column in **Figures S1 and S2**). However, these changes did not translate into FCL because $C$ and $P$ occupy a similar trophic position (**Figure 1D**). Meanwhile, the occupancy of $P$ decreased with ecosystem complexity when omnivory was strong, but FCL remained almost the same as the increase of $C$ could compensate for the loss of $P$ (**Figure S3 and S4**).

## **High disturbance regime**

On average, increased disturbance frequency decreased FCL, and omnivory had similar effects on FCL (**Figure 3**). More importantly, a high disturbance regime produced different responses of FCL to ecosystem properties. FCL increased across gradients of ecosystem size and complexity under all productivity, omnivory, and dispersal scenarios (**Figure 3**). The effect of ecosystem complexity was generally clearer than that of ecosystem size. It is important to note that the positive relationships emerged in a high disturbance regime because smaller and simpler ecosystems were disproportionately vulnerable to increased disturbance frequency (compare far left along the x-axis in each panel of **Figures 2 and 3**).

Dispersal buffered the disturbance effects on FCL and the magnitude of buffering differed by ecosystem structure. Larger ecosystems benefited more from long dispersal (compare top and bottom panels in **Figure 3**) because greater dispersal capability is required to reach distant patches. In particular, this pattern is clearer in simple, less branched ecosystems because habitat patches are more isolated in linearly arranged networks (**Figure 3**). Productivity increased FCL as observed in a low disturbance regime, but it did not modulate the qualitative relationships between FCL and ecosystem properties (compare left and right panels in **Figure 3**).

When strong omnivory exists in low-productivity systems, different processes drove the positive effects of ecosystem size and complexity on FCL. The positive effects of ecosystem size are mainly explained by the increased occupancy of $P$ (third column from left in **Figure S1 and S2**). In contrast, the increased occupancy of $C$ maintained the positive relationship between FCL and ecosystem complexity (third column from left in **Figure S3 and S4**).

# Discussion

The ecosystem size hypothesis of FCL has received support from both theoretical and empirical research [@vanderzandenPatternsFoodChain1999; @postEcosystemSizeDetermines2000; @takimotoEffectsProductivityDisturbance2012], although empirical work so far has rarely elaborated on the underlying drivers [but see @saboRoleDischargeVariation2010; @wardMechanisticTheoryAquatic2017]. In contrast, ecosystem complexity has not been incorporated in theoretical explorations of FCL to date. Here, we show that FCL responds positively to increasing ecosystem size and complexity, assessed as the number of patches and branching probability in river networks. This supports our hypothesis that ecosystem complexity may represent an overlooked yet important extrinsic control of FCL. However, the relationship between FCL and ecosystem complexity varied with other extrinsic and intrinsic factors, supporting the emerging paradigm that FCL is regulated by multiple factors [@mchughDualInfluencesEcosystem2010; @wardMechanisticTheoryAquatic2017]. Although we focus on river networks here, we expect our results to be transferable to other systems with branching structures, such as mountain ranges and cave systems. Our findings should also be relevant to non-branching systems, where different metrics of ecosystem complexity would be necessary.

While increased disturbance frequency consistently reduced FCL as predicted by the dynamical stability hypothesis [@pimmNumberTrophicLevels1977], more important findings in this study were evident from their synergistic effects with ecosystem structure. Our low disturbance regime scenario can be viewed as habitat networks having nearly homogeneous environments, in which long food chains were generally supported independently of ecosystem size and complexity. Consequently, the food web structure largely controlled FCL. However, under high disturbance regimes, only large and complex networks could provide diverse and heterogeneous habitats with potential refugia, allowing species to thrive and maintain long food chains. While empirical studies rarely looked at the influence of ecosystem complexity on FCL, several studies provide some support for this theoretical prediction. For example, @sullivanEcosystemStructureEmerges2015 reported FCL is controlled primarily by the number of tributary confluences in Idaho streams. Similarly, it has been shown that the merging of major tributaries lengthened FCL in the Colorado River, especially during a post-monsoon turbid water phase [@saboPulsedFlowsTributary2018]. More empirical research is needed to confirm our theoretical predictions.

The interactive effect of disturbance and ecosystem structure has important implications for ecosystem management because anthropogenic climate change is predicted to increase the frequency and magnitude of disturbances [@brunnerFutureStreamflowRegime2020; @mittalImpactHumanIntervention2016]. River networks are especially vulnerable due to their propensity to go dry during droughts [@zipperPervasiveChangesStream2021] as well as susceptibility to more intense flood disturbance with increasing storm intensity [@schiermeierIncreasedFloodRisk2011]. Therefore, the preservation of habitat diversity conferred by ecosystem size and complexity is critical to biodiversity conservation under rapid environmental changes. In addition, maintaining habitat connectivity is particularly important for large, linearly-arranged networks. Although dispersal has received less attention in food chain research [but see @pillaiMetacommunityTheoryExplains2011; @takimotoEffectsProductivityDisturbance2012; @wangMetapopulationCapacityDetermines2021], our simulation highlighted food webs in these networks are more vulnerable to habitat fragmentation because habitat patches are inherently isolated from one another. Dams and road crossings have altered the connectivity between suitable habitat patches or have completely blocked dispersal [@ishiyamaPredictingEcologicalImpacts2018; @moritaEffectsHabitatFragmentation2002; @perkinFragmentationAltersStream2012]. Light pollution has also negatively affected the ability of adult aquatic insects to disperse between habitat patches [@perkinEffectsArtificialLighting2014]. These human activities may disproportionately impact food webs in large watersheds with simple network structures.

It is not surprising that FCL declined with increasing omnivory because it effectively compresses a food web (**Figure 1C**) and/or intensifies competition between consumer and predator species. However, how omnivory influences the associations with ecosystem structure has rarely been explored [@takimotoEffectsProductivityDisturbance2012; @wardMechanisticTheoryAquatic2017]. An important result in our simulation is that omnivory does not change the qualitative relationships between FCL and ecosystem properties, as opposed to productivity effects. This result provides a possible explanation for why the ecosystem size hypothesis has been consistently supported in various ecosystems [@takimotoEnvironmentalDeterminantsFoodchain2013] and raises the possibility of ecosystem complexity as an important control of FCL in branching networks. In addition, our results imply that the size and complexity effects are robust to food web reorganization, which is often associated with species extirpations or introductions. The strength of omnivory in these novel communities can be increased or decreased, depending on the introduced species and the extant species pool or community. For example, non-indigenous fishes in the Eastern Mediterranean Sea outcompete native species for high-quality prey items, causing native species to increase their consumption of non-preferred prey items [@fanelliDepictingNovelEastern2015]. However, such substantial changes in food web structure may have limited influences on how ecosystem structure dictates FCL.

Our findings add an important distinction to work to assess and prioritize protection or conservation status within human impacted regions. Classical conservation schemes emphasize ecosystem size, aiming to protect the largest areas possible [@diamondIslandDilemmaLessons1975]. While this is certainly a useful attribute generally, designating networks with a high degree of variability, or many small patches, can be more beneficial than a large, homogeneous area [@fahrigWhySeveralSmall2020]. Accounting for ecosystem complexity is particularly suited to ecosystem architectures in which branches have variable environmental conditions [@koningNetworkGrassrootsReserves2020; @teruiEmergentDualScaling2021]. As suggested by modern conservation initiatives, conservation and management activities should focus on activities that increase the habitat heterogeneity and connectivity of suitable habitat patches to increase resilience to predicted increases in disturbance frequency and magnitude [@schindlerPopulationDiversityPortfolio2010; @schindlerPortfolioConceptEcology2015; @andersonPortfolioConservationMetapopulations2015].

It is abundantly clear that ecosystem complexity in natural systems is the rule, not the exception. Early theoretical and empirical work has assumed simple habitat structure as a necessity. However, habitat heterogeneity, such as prey refugia, and dispersal between connected habitat patches allow communities to stabilize and persist through space and time [@pedersenNonhierarchicalDispersalPromotes2016; @mougiFoodwebComplexityMetacommunity2016]. Complex ecosystem structure is an extrinsic factor that can affect FCL in communities. Incorporating a realistic understanding of ecosystem structural complexity may improve our perception of communities in naturally complex systems.

## Acknowledgements

We thank C Perovich for thoughtful discussions in the early stages of this project. This material is based upon work supported by the National Science Foundation through the Division of Environmental Biology (DEB 2015634).

## Author contributions

JP developed the theoretical model of trophic dynamics with input from AT. JP and AT ran the simulations, and made the figures. JP wrote the first draft, while AT and JF contributed significantly to the final version.

# References
